{% extends "base.html" %}

{% block title %}Shopping Cart | Hop & Barley{% endblock %}

{% block content %}
<main class="cart-page-wrapper">
  <div class="cart-container">
    <h1 class="cart-title">Shopping Cart</h1>

    {% if cart_items %}
    <div class="cart-items-list" id="cart-items-list">
      {% for item in cart_items %}
      <div class="cart-item" data-price="{{ item.product.price }}" data-product-id="{{ item.product.id }}">
        <img src="{{ url_for('static', path='/img/products/' + (item.product.image or 'default.jpg')) }}" alt="{{ item.product.name }}" class="cart-item__image">
        <div class="cart-item__body">
          <div class="cart-item__details">
            <h2 class="cart-item__name">{{ item.product.name }}</h2>
            <div class="cart-item__price-info">
              <p class="cart-item__price" data-item-total-price>
                ${{ "%.2f"|format(item.product.price * item.quantity) }}
              </p>
              <span class="cart-item__price-tag">${{ "%.2f"|format(item.product.price) }} each</span>
            </div>
          </div>
          <div class="cart-item__actions">
            <form method="post" action="{{ url_for('cart_update') }}" class="quantity-form">
              <input type="hidden" name="product_id" value="{{ item.product.id }}">
              <div class="cart-item__quantity-selector">
                <button type="submit" name="action" value="decrease" class="quantity-btn-cart" {% if item.quantity <= 1 %}disabled{% endif %}>
                  <i class="fa-solid fa-minus"></i>
                </button>
                <span class="quantity-value-cart">{{ item.quantity }}</span>
                <button type="submit" name="action" value="increase" class="quantity-btn-cart" {% if item.quantity >= item.product.stock %}disabled{% endif %}>
                  <i class="fa-solid fa-plus"></i>
                </button>
              </div>
            </form>
            <form method="post" action="{{ url_for('cart_remove') }}" class="remove-form">
              <input type="hidden" name="product_id" value="{{ item.product.id }}">
              <button type="submit" class="button--remove">
                Remove <i class="fa-solid fa-xmark"></i>
              </button>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="cart-summary">
      <div class="cart-summary__total">
        <p>Total</p>
        <p id="cart-total-price">${{ "%.2f"|format(total_price) }}</p>
      </div>
      <a href="{{ url_for('checkout') }}" class="button button--primary button--checkout">Proceed to Checkout</a>
    </div>
    {% else %}
    <div class="cart-empty">
      <p>Your cart is empty</p>
      <a href="{{ url_for('home') }}" class="button button--primary">Continue Shopping</a>
    </div>
    {% endif %}
  </div>
</main>
{% endblock %}
